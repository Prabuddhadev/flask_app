<!DOCTYPE html>
<html>
<head>
    <title>Docket Creation Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            background-color: #0074d9;
            color: #fff;
            padding: 10px;
            margin: 0;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
            color: #333;
        }

        input[type="text"],
        input[type="number"],
        input[type="datetime-local"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        select {
            height: 40px;
        }

        .descriptionBlock {
            margin-top: 20px;
        }

        h3 {
            color: #0074d9;
        }

        #description {
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        button {
            background-color: #0074d9;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Create a Docket</h1>
    <form id="docketForm">
        <div class="container">
            <label for="name">Name: </label>
            <input type="text" id="name" name="name">

            <label for="startTime">Start time: </label>
            <input type="datetime-local" id="startTime" name="startTime">

            <label for="endTime">End time: </label>
            <input type="datetime-local" id="endTime" name="endTime">

            <label for="hoursWorked">No. of hours worked: </label>
            <input type="number" id="hoursWorked" name="hoursWorked">

            <label for="ratePerHour">Rate per hour: </label>
            <input type="number" id="ratePerHour" name="ratePerHour">

            <!-- Supplier Dropdown -->
            <label for="supplier">Supplier: </label>
            <select id="supplier" name="supplier"></select>

            <!-- Purchase Order (PO) Dropdown -->
            <label for="po">PO Number: </label>
            <select id="po" name="po"></select>

            <!-- Description Block -->
            <div class="descriptionBlock">
                <h3>Description:</h3>
                <p id="description"></p>
            </div>

            <button type="button" id="submitButton">Submit</button>
        </div>
    </form>
    <script>
        // Function to populate the Supplier dropdown from the API
        function populateSupplierDropdown() {
            // Make a GET request to the Supplier API endpoint
            fetch('http://localhost:5000/suppliers')
                .then(response => response.json())
                .then(data => {
                    const supplierDropdown = document.getElementById('supplier');
                    supplierDropdown.innerHTML = ''; // Clear existing options

                    // Add an empty default option
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.text = 'Select Supplier';
                    supplierDropdown.appendChild(defaultOption);

                    data.Supplier.forEach(supplier => {
                        const option = document.createElement('option');
                        option.value = supplier;
                        option.text = supplier;
                        supplierDropdown.appendChild(option);
                    });
                });
        }

        // Function to populate the PO Number dropdown based on the selected supplier
        function populatePODropdown(selectedSupplier) {
            if (selectedSupplier) {
                // Make a POST request to the PO Details API endpoint
                fetch('http://localhost:5000/po_details', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ supplier: selectedSupplier })
                })
                    .then(response => response.json())
                    .then(data => {
                        const poDropdown = document.getElementById('po');
                        poDropdown.innerHTML = ''; // Clear existing options

                        // Add an empty default option
                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.text = 'Select PO Number';
                        poDropdown.appendChild(defaultOption);

                        data.purchase_order_details.forEach(po => {
                            const option = document.createElement('option');
                            option.value = po;
                            option.text = po;
                            poDropdown.appendChild(option);
                        });
                    });
            } else {
                // If no supplier is selected, clear the PO dropdown
                const poDropdown = document.getElementById('po');
                poDropdown.innerHTML = '';
            }
        }

        // Function to populate the description block based on the selected PO Number
        function populateDescription(selectedPO) {
            if (selectedPO) {
                // Make a POST request to the PO Description API endpoint
                fetch('http://localhost:5000/po_disc', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ purchase_ordr_num: selectedPO })
                })
                    .then(response => response.json())
                    .then(data => {
                        const description = document.getElementById('description');
                        description.innerHTML = data.description.join('<br>');
                    });
            } else {
                // If no PO Number is selected, clear the description block
                const description = document.getElementById('description');
                description.innerHTML = '';
            }
        }

        // Event listeners for dropdowns
        document.getElementById('supplier').addEventListener('change', function () {
            const selectedSupplier = this.value;
            populatePODropdown(selectedSupplier);
        });

        document.getElementById('po').addEventListener('change', function () {
            const selectedPO = this.value;
            populateDescription(selectedPO);
        });
// Event listener for the Submit button
document.getElementById('submitButton').addEventListener('click', function () {
    const form = document.getElementById('docketForm');
    const formData = new FormData(form);
    const formObject = {};

    formData.forEach((value, key) => {
        if (key !== 'po') {
            formObject[key] = [value];
        }
    });

    // Fetch the selected PO Number
    const selectedPO = document.getElementById('po').value;

    // Make a POST request to get the PO description
    fetch('http://localhost:5000/po_disc', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ purchase_ordr_num: selectedPO })
    })
    .then(response => response.json())
    .then(data => {
        // Add the description to the formObject
        formObject['description'] = [data.description.join(', ')];

        // Create the request object
        const reqObj = { 'data': formObject };

        // Make a POST request to the 'http://localhost:5000/submit' endpoint
        fetch('http://localhost:5000/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(reqObj)
        })
        .then(response => {
            // Handle the response as needed
            console.log('Form submitted successfully');
        });
    });
});



        // Populate the Supplier dropdown when the page loads
        populateSupplierDropdown();
    </script>
</body>
</html>